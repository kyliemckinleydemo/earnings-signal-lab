<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earnings Signal Lab</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Instrument+Serif&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #06060f; --bg2: #0c0c1a; --bg3: #12122a;
    --border: #1a1a35; --text: #d4d4e8; --dim: #6b7094;
    --green: #3de8a0; --red: #f06878; --amber: #f0c848;
    --blue: #5898f0; --purple: #a878f0;
    --mono: 'IBM Plex Mono', monospace;
    --serif: 'Instrument Serif', serif;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:var(--mono); font-size:13px; line-height:1.5; min-height:100vh; }
  a { color:var(--blue); text-decoration:none; }

  .header { background:linear-gradient(180deg, var(--bg2), var(--bg)); border-bottom:1px solid var(--border); padding:28px 32px 24px; }
  .header h1 { font-family:var(--serif); font-size:32px; font-weight:400; letter-spacing:-0.5px; margin-bottom:4px; }
  .header h1 span.g { color:var(--green); }
  .header h1 span.b { color:var(--blue); }
  .header .meta { font-size:11px; color:var(--dim); }
  .header .meta strong { color:var(--text); font-weight:500; }

  .tabs { display:flex; gap:0; border-bottom:1px solid var(--border); padding:0 32px; background:var(--bg); position:sticky; top:0; z-index:10; }
  .tab { background:none; border:none; border-bottom:2px solid transparent; color:var(--dim); padding:11px 18px; font:600 11px/1 var(--mono); cursor:pointer; text-transform:uppercase; letter-spacing:1px; transition:all 0.15s; }
  .tab:hover { color:var(--text); }
  .tab.active { color:var(--green); border-bottom-color:var(--green); }

  .content { padding:24px 32px; max-width:1400px; }

  /* Cards */
  .card { background:var(--bg2); border:1px solid var(--border); border-radius:8px; padding:16px; margin-bottom:12px; transition:border-color 0.15s; }
  .card:hover { border-color:var(--dim); }
  .card.selected { border-color:var(--green); }

  /* Feature list */
  .features-grid { display:grid; grid-template-columns:1fr 1.6fr; gap:16px; }
  .feat-list { display:flex; flex-direction:column; gap:8px; max-height:82vh; overflow-y:auto; padding-right:8px; }
  .feat-list::-webkit-scrollbar { width:4px; }
  .feat-list::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

  .feat-card { cursor:pointer; }
  .feat-name { font-size:12px; font-weight:600; margin-bottom:2px; }
  .feat-desc { font-size:10px; color:var(--dim); }
  .feat-tag { font-size:9px; padding:1px 6px; border-radius:3px; display:inline-block; margin-top:3px; }
  .feat-stats { display:flex; gap:10px; margin-top:6px; font-size:10px; color:var(--dim); }
  .feat-ic { font-size:17px; font-weight:700; text-align:right; }

  /* Period grid */
  .period-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-bottom:20px; }
  .period-box { background:var(--bg3); border-radius:6px; padding:10px; text-align:center; }
  .period-label { font-size:10px; color:var(--dim); margin-bottom:4px; }
  .period-ic { font-size:20px; font-weight:700; }
  .period-stats { font-size:10px; color:var(--dim); margin-top:6px; line-height:1.6; }

  /* Samples */
  .sample { background:var(--bg3); border-radius:6px; padding:10px; margin-bottom:6px; border-left:3px solid var(--dim); }

  /* Combos */
  .combo { border-left:3px solid var(--amber); }

  /* Model comparison */
  .model-row { display:flex; justify-content:space-between; align-items:center; padding:8px 12px; border-radius:4px; margin-bottom:4px; }
  .model-row:nth-child(1) { background:rgba(61,232,160,0.08); }
  .model-bar { height:6px; border-radius:3px; background:var(--green); transition:width 0.3s; }

  /* Summary */
  .summary-content { font-size:13px; line-height:1.8; max-width:800px; }
  .summary-content h2 { font-family:var(--serif); font-size:22px; font-weight:400; color:var(--green); margin:28px 0 12px; }
  .summary-content h2:first-child { margin-top:0; }
  .summary-content strong { color:var(--text); font-weight:600; }
  .summary-content ul { margin:8px 0 8px 20px; }
  .summary-content li { margin-bottom:4px; }
  .summary-content code { background:var(--bg3); padding:1px 5px; border-radius:3px; font-size:12px; }

  /* Filters */
  .filters { display:flex; gap:5px; margin-bottom:14px; flex-wrap:wrap; }
  .filter-btn { background:transparent; border:1px solid var(--border); color:var(--dim); border-radius:5px; padding:4px 11px; font:500 10px var(--mono); cursor:pointer; transition:all 0.15s; }
  .filter-btn:hover { border-color:var(--dim); }
  .filter-btn.active { background:var(--bg3); border-color:var(--green); color:var(--green); }

  /* Correlation table */
  .corr-table { border-collapse:collapse; }
  .corr-table th { font-size:8px; font-weight:500; padding:3px; writing-mode:vertical-lr; transform:rotate(180deg); height:70px; text-align:left; }
  .corr-table td.label { font-size:9px; font-weight:500; white-space:nowrap; padding:3px 6px 3px 0; }
  .corr-cell { border-radius:2px; padding:4px 2px; font-size:9px; text-align:center; min-width:32px; }

  /* Loading */
  .loading { text-align:center; padding:80px 20px; color:var(--dim); }
  .loading .spinner { display:inline-block; width:24px; height:24px; border:2px solid var(--border); border-top-color:var(--green); border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:12px; }
  @keyframes spin { to { transform:rotate(360deg); } }

  /* Responsive */
  @media (max-width:900px) {
    .features-grid { grid-template-columns:1fr; }
    .period-grid { grid-template-columns:repeat(2,1fr); }
    .content { padding:16px; }
    .header { padding:20px 16px; }
    .tabs { padding:0 16px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1><span class="g">Earnings</span> Signal <span class="b">Lab</span></h1>
  <div class="meta" id="meta">Loading...</div>
</div>

<div class="tabs" id="tabs">
  <button class="tab active" data-tab="features">Features</button>
  <button class="tab" data-tab="models">Models</button>
  <button class="tab" data-tab="combos">Combinations</button>
  <button class="tab" data-tab="correlations">Correlations</button>
  <button class="tab" data-tab="summary">Summary</button>
</div>

<div class="content" id="content">
  <div class="loading"><div class="spinner"></div><div>Loading results...</div></div>
</div>

<script>
// ============================================================
// Feature metadata (public — no secret info)
// ============================================================
const FM = {
  mgmt_hedging: { name:"Management Hedging", cat:"Management", color:"#e74c3c", bear:true, desc:"Hedging vs definitive language" },
  mgmt_deflection: { name:"Q&A Deflection", cat:"Management", color:"#c0392b", bear:true, desc:"Non-answers in Q&A" },
  mgmt_specificity: { name:"Guidance Specificity", cat:"Management", color:"#e67e22", bear:false, desc:"Specific numbers vs vague" },
  mgmt_confidence_shift: { name:"Confidence Shift", cat:"Management", color:"#d35400", bear:true, desc:"Drop from prepared→Q&A" },
  analyst_skepticism: { name:"Analyst Skepticism", cat:"Analyst", color:"#2980b9", bear:true, desc:"Challenging follow-ups" },
  analyst_surprise: { name:"Analyst Surprise", cat:"Analyst", color:"#3498db", bear:false, desc:"Unexpected info reactions" },
  analyst_focus_cluster: { name:"Question Clustering", cat:"Analyst", color:"#1abc9c", bear:false, desc:"Analysts converge on topic" },
  guidance_revision_dir: { name:"Guidance Direction", cat:"Guidance", color:"#9b59b6", bear:false, desc:"Raised vs lowered" },
  guidance_qualifiers: { name:"Qualifier Density", cat:"Guidance", color:"#8e44ad", bear:true, desc:"Conditional language" },
  new_risk_mention: { name:"New Risk Mentions", cat:"Risk", color:"#e74c3c", bear:true, desc:"First-time risk factors" },
  macro_blame: { name:"External Blame", cat:"Risk", color:"#c0392b", bear:true, desc:"Blaming macro vs ownership" },
  capex_language: { name:"CapEx Tone", cat:"Strategic", color:"#27ae60", bear:false, desc:"Expansion vs cautious" },
  hiring_language: { name:"Hiring Signals", cat:"Strategic", color:"#2ecc71", bear:false, desc:"Growth vs restructuring" },
  competitive_mentions: { name:"Competitive Position", cat:"Strategic", color:"#16a085", bear:true, desc:"Concerned vs dismissive" },
  customer_language: { name:"Demand Descriptors", cat:"Demand", color:"#f39c12", bear:false, desc:"Robust vs softening" },
  pricing_power: { name:"Pricing Power", cat:"Demand", color:"#f1c40f", bear:false, desc:"Raising vs discounting" },
};
const CATS = [...new Set(Object.values(FM).map(f=>f.cat))];
const PDS = ["1D","5D","10D","21D"];

// ============================================================
// State
// ============================================================
let DATA = null;
let activeTab = "features";
let selectedFeat = null;
let catFilter = "All";

// ============================================================
// Fetch data
// ============================================================
async function init() {
  try {
    const res = await fetch("/api/results");
    if (!res.ok) throw new Error(`${res.status}: ${res.statusText}`);
    DATA = await res.json();
    renderMeta();
    renderTab();
  } catch(e) {
    document.getElementById("content").innerHTML =
      `<div class="loading" style="color:var(--red)">
        <div style="font-size:16px;margin-bottom:8px">No data available</div>
        <div style="font-size:11px">${e.message}<br>Pipeline may not have run yet.</div>
       </div>`;
  }
}

function renderMeta() {
  const m = DATA.metadata || {};
  document.getElementById("meta").innerHTML =
    `<strong>${m.total_events||0}</strong> earnings events · ` +
    `<strong>${(m.companies||[]).length}</strong> companies · ` +
    `${(m.date_range||[])[0]||"?"} to ${(m.date_range||[])[1]||"?"} · ` +
    `Updated: ${DATA.last_updated ? new Date(DATA.last_updated).toLocaleDateString() : "?"}`;
}

// ============================================================
// Tab routing
// ============================================================
document.getElementById("tabs").addEventListener("click", e => {
  if (!e.target.classList.contains("tab")) return;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  e.target.classList.add("active");
  activeTab = e.target.dataset.tab;
  renderTab();
});

function renderTab() {
  if (!DATA) return;
  const el = document.getElementById("content");
  switch(activeTab) {
    case "features": el.innerHTML = renderFeatures(); break;
    case "models": el.innerHTML = renderModels(); break;
    case "combos": el.innerHTML = renderCombos(); break;
    case "correlations": el.innerHTML = renderCorrelations(); break;
    case "summary": el.innerHTML = renderSummary(); break;
  }
  attachListeners();
}

function icColor(ic) { const a=Math.abs(ic); return a>0.15?"var(--green)":a>0.08?"var(--amber)":"var(--dim)"; }
function retColor(r) { return r>0?"var(--green)":"var(--red)"; }

// ============================================================
// Features tab
// ============================================================
function renderFeatures() {
  const fids = Object.keys(FM);
  const filtered = catFilter==="All" ? fids : fids.filter(f=>FM[f].cat===catFilter);
  const sorted = [...filtered].sort((a,b) => {
    const aD=DATA.features?.[a], bD=DATA.features?.[b];
    if(!aD&&!bD)return 0; if(!aD)return 1; if(!bD)return -1;
    return Math.max(...Object.values(bD).map(p=>Math.abs(p.ic||0))) - Math.max(...Object.values(aD).map(p=>Math.abs(p.ic||0)));
  });

  let filters = `<div class="filters">`;
  ["All",...CATS].forEach(c => {
    filters += `<button class="filter-btn ${catFilter===c?"active":""}" data-cat="${c}">${c}</button>`;
  });
  filters += `</div>`;

  let list = `<div class="feat-list">`;
  sorted.forEach(fid => {
    const m=FM[fid], d=DATA.features?.[fid];
    let bestIC=0, bestP="";
    if(d) Object.entries(d).forEach(([p,s])=>{ if(Math.abs(s.ic||0)>Math.abs(bestIC)){bestIC=s.ic;bestP=p;} });
    list += `<div class="card feat-card ${selectedFeat===fid?"selected":""}" data-fid="${fid}">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div style="flex:1"><div class="feat-name" style="color:${m.color}">${m.name}</div>
          <div class="feat-desc">${m.desc}</div>
          ${m.bear?`<div class="feat-tag" style="color:var(--red);background:rgba(240,104,120,0.1)">bearish when high</div>`:""}
        </div>
        ${d?`<div><div class="feat-ic" style="color:${icColor(bestIC)}">${bestIC>0?"+":""}${bestIC.toFixed(3)}</div>
          <div style="font-size:9px;color:var(--dim);text-align:right">IC @ ${bestP}</div></div>`:""}
      </div>
      ${d?`<div class="feat-stats"><span>Acc: ${((d[bestP]?.accuracy||0)*100).toFixed(0)}%</span>
        <span>Win: ${((d[bestP]?.win_rate||0)*100).toFixed(0)}%</span>
        <span>p=${d[bestP]?.ic_pvalue?.toFixed(3)}</span>
        <span>n=${d[bestP]?.n_observations}</span></div>`:""}
    </div>`;
  });
  list += `</div>`;

  let detail = "";
  if (selectedFeat && DATA.features?.[selectedFeat]) {
    const m=FM[selectedFeat], d=DATA.features[selectedFeat];
    detail = `<div class="card"><div style="font-size:15px;font-weight:700;color:${m.color};margin-bottom:2px">${m.name}</div>
      <div style="font-size:11px;color:var(--dim);margin-bottom:16px">${m.desc}</div>
      <div style="font-size:12px;font-weight:600;margin-bottom:8px">Signal by Holding Period</div>
      <div class="period-grid">${PDS.map(p=>{
        const s=d[p]; if(!s) return `<div class="period-box" style="opacity:0.4"><div class="period-label">${p}</div><div>—</div></div>`;
        return `<div class="period-box"><div class="period-label">${p}</div>
          <div class="period-ic" style="color:${icColor(s.ic||0)}">${(s.ic||0)>0?"+":""}${(s.ic||0).toFixed(3)}</div>
          <div style="font-size:9px;color:var(--dim)">IC</div>
          <div class="period-stats">Acc: ${((s.accuracy||0)*100).toFixed(1)}%<br>Win: ${((s.win_rate||0)*100).toFixed(1)}%<br>
          Ret: ${(s.avg_return_pct||0)>0?"+":""}${(s.avg_return_pct||0).toFixed(2)}%<br>Sharpe: ${(s.sharpe||0).toFixed(2)}<br>
          p: ${(s.ic_pvalue||0).toFixed(4)}<br>n=${s.n_observations}</div></div>`;
      }).join("")}</div>`;

    // Samples (scores + returns only, no evidence)
    const samples = DATA.sample_extractions?.[selectedFeat] || [];
    if(samples.length) {
      detail += `<div style="font-size:12px;font-weight:600;margin:16px 0 8px">Sample Signals</div>`;
      samples.forEach(s => {
        const sc = s.score>0.6?(m.bear?"var(--red)":"var(--green)"):s.score<0.4?(m.bear?"var(--green)":"var(--red)"):"var(--amber)";
        detail += `<div class="sample" style="border-left-color:${sc}">
          <div style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:4px">
            <span style="font-weight:600">${s.symbol} <span style="color:var(--dim);font-weight:400">${s.quarter}</span></span>
            <div style="display:flex;gap:8px;align-items:center">
              <span style="font-size:10px;padding:1px 6px;border-radius:3px;background:rgba(255,255,255,0.04);color:var(--dim)">Score: ${s.score}</span>
              ${s.return_5D!=null?`<span style="font-size:11px;font-weight:600;color:${retColor(s.return_5D)}">5D: ${s.return_5D>0?"+":""}${Number(s.return_5D).toFixed(1)}%</span>`:""}
              ${s.return_10D!=null?`<span style="font-size:11px;font-weight:600;color:${retColor(s.return_10D)}">10D: ${s.return_10D>0?"+":""}${Number(s.return_10D).toFixed(1)}%</span>`:""}
            </div>
          </div></div>`;
      });
    }
    detail += `</div>`;
  } else {
    detail = `<div class="card" style="text-align:center;padding:60px 20px;color:var(--dim)">
      <div style="font-size:28px;margin-bottom:6px">←</div>Select a feature to view details</div>`;
  }

  return filters + `<div class="features-grid">${list}<div>${detail}</div></div>`;
}

// ============================================================
// Models tab
// ============================================================
function renderModels() {
  const reg = DATA.regression || {};
  if (!Object.keys(reg).length) return `<div class="loading" style="color:var(--dim)">No regression results available.</div>`;

  let html = `<div style="font-size:14px;font-weight:600;margin-bottom:4px">Regression Model Comparison</div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:16px">Cross-validated R² — higher is better. Negative means worse than predicting the mean.</div>`;

  for (const [period, pdata] of Object.entries(reg)) {
    const comparison = pdata.model_comparison || [];
    const maxR2 = Math.max(...comparison.map(m=>m.cv_r2), 0.01);
    const weights = pdata.recommended_weights?.weights || {};
    const weightsSorted = Object.entries(weights).sort((a,b)=>Math.abs(b[1])-Math.abs(a[1]));

    html += `<div class="card"><div style="font-size:14px;font-weight:600;margin-bottom:4px">${period} Forward Returns</div>
      <div style="font-size:10px;color:var(--dim);margin-bottom:12px">n=${pdata.n_observations||"?"} · mean=${pdata.y_mean||"?"}% · std=${pdata.y_std||"?"}%</div>`;

    comparison.forEach((m,i) => {
      const barW = Math.max(0, m.cv_r2/maxR2*100);
      html += `<div class="model-row" ${i===0?'style="background:rgba(61,232,160,0.08)"':""}>
        <span style="font-size:11px;font-weight:${i===0?700:400};color:${i===0?"var(--green)":"var(--text)"}; min-width:140px">${m.model}${i===0?" ✦":""}</span>
        <div style="flex:1;margin:0 16px"><div class="model-bar" style="width:${barW}%;background:${i===0?"var(--green)":m.cv_r2>0?"var(--blue)":"var(--red)"}"></div></div>
        <span style="font-size:12px;font-weight:600;color:${m.cv_r2>0?"var(--green)":"var(--red)"}; min-width:70px;text-align:right">${m.cv_r2.toFixed(4)}</span>
      </div>`;
    });

    if (weightsSorted.length) {
      html += `<div style="margin-top:16px;font-size:12px;font-weight:600;margin-bottom:8px">Recommended Weights</div>
        <div style="font-size:10px;color:var(--dim);margin-bottom:8px">${pdata.recommended_weights?.method||""}</div>`;
      weightsSorted.forEach(([name,w]) => {
        html += `<div style="display:flex;justify-content:space-between;padding:3px 0;font-size:11px">
          <span style="color:${FM[name]?.color||"var(--text)"}">${FM[name]?.name||name}</span>
          <span style="font-weight:600;color:${w>0?"var(--green)":"var(--red)"}">${w>0?"+":""}${w.toFixed(4)}</span></div>`;
      });
    }
    html += `</div>`;
  }
  return html;
}

// ============================================================
// Combinations tab
// ============================================================
function renderCombos() {
  const combos = DATA.combinations || [];
  if (!combos.length) return `<div class="loading" style="color:var(--dim)">No combination results.</div>`;

  let html = `<div style="font-size:14px;font-weight:600;margin-bottom:4px">Multi-Feature Combinations</div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:14px">Combining uncorrelated features for stronger composite signals</div>`;

  [...combos].sort((a,b)=>Math.abs(b.sharpe)-Math.abs(a.sharpe)).forEach(c => {
    const color = Math.abs(c.sharpe)>1?"var(--green)":Math.abs(c.sharpe)>0.5?"var(--amber)":"var(--blue)";
    html += `<div class="card combo" style="border-left-color:${color}">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div><div style="font-size:13px;font-weight:600">${c.name}</div>
          <div style="display:flex;gap:4px;margin-top:6px;flex-wrap:wrap">
            ${(c.features||[]).map(f=>`<span style="font-size:9px;padding:1px 6px;border-radius:3px;background:${FM[f]?.color||"#666"}22;color:${FM[f]?.color||"#999"}">${FM[f]?.name||f}</span>`).join("")}
          </div></div>
        <div style="text-align:right;flex-shrink:0;margin-left:12px">
          <div style="font-size:20px;font-weight:700;color:${color}">${(c.sharpe||0).toFixed(2)}</div>
          <div style="font-size:9px;color:var(--dim)">Sharpe @ ${c.period}</div></div></div>
      <div style="display:flex;gap:12px;margin-top:8px;font-size:10px;color:var(--dim)">
        <span>Avg: ${(c.avg_return||0)>0?"+":""}${(c.avg_return||0).toFixed(2)}%</span>
        <span>Win: ${((c.win_rate||0)*100).toFixed(0)}%</span>
        <span>${c.n_triggered}/${c.n_total} triggered</span></div></div>`;
  });
  return html;
}

// ============================================================
// Correlations tab
// ============================================================
function renderCorrelations() {
  const matrix = DATA.correlation_matrix || {};
  const fs = Object.keys(matrix).filter(f=>FM[f]).slice(0,12);
  if (!fs.length) return `<div class="loading" style="color:var(--dim)">No correlation data.</div>`;

  let html = `<div style="font-size:14px;font-weight:600;margin-bottom:4px">Feature Correlation Matrix</div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:14px">High correlation = redundant signal. Combine uncorrelated features.</div>
    <div style="overflow-x:auto"><table class="corr-table"><thead><tr><th></th>`;
  fs.forEach(f => { html += `<th style="color:${FM[f]?.color}">${FM[f]?.name?.split(" ")[0]}</th>`; });
  html += `</tr></thead><tbody>`;
  fs.forEach(f1 => {
    html += `<tr><td class="label" style="color:${FM[f1]?.color}">${FM[f1]?.name?.split(" ")[0]}</td>`;
    fs.forEach(f2 => {
      const v=matrix[f1]?.[f2]??0, a=Math.abs(v);
      const bg = f1===f2 ? "var(--bg3)" : a>0.5?`rgba(240,104,120,${a*0.4})` : a>0.3?`rgba(240,200,72,${a*0.35})` : a>0.1?`rgba(61,232,160,${a*0.25})`:"rgba(255,255,255,0.02)";
      html += `<td><div class="corr-cell" style="background:${bg};font-weight:${a>0.3?600:400};color:${f1===f2?"var(--dim)":"var(--text)"}">${f1===f2?"—":v.toFixed(2)}</div></td>`;
    });
    html += `</tr>`;
  });
  html += `</tbody></table></div>`;
  return html;
}

// ============================================================
// Summary tab
// ============================================================
function renderSummary() {
  const md = DATA.summary || "";
  if (!md) return `<div class="loading" style="color:var(--dim)">No summary available. Run the pipeline with Claude API to generate one.</div>`;

  // Basic markdown→HTML (handles ##, **, *, -, `, code blocks)
  let html = md
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^### (.+)$/gm, '<h3 style="font-size:15px;color:var(--blue);margin:20px 0 8px">$1</h3>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/`([^`]+)`/g, '<code>$1</code>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>')
    .replace(/\n\n/g, '<br><br>')
    .replace(/\n(?!<)/g, '<br>');

  return `<div class="summary-content">${html}</div>`;
}

// ============================================================
// Event listeners
// ============================================================
function attachListeners() {
  // Feature cards
  document.querySelectorAll(".feat-card").forEach(el => {
    el.addEventListener("click", () => {
      selectedFeat = el.dataset.fid;
      renderTab();
    });
  });
  // Category filters
  document.querySelectorAll(".filter-btn").forEach(el => {
    el.addEventListener("click", () => {
      catFilter = el.dataset.cat;
      renderTab();
    });
  });
}

// ============================================================
// Boot
// ============================================================
init();
</script>
</body>
</html>
